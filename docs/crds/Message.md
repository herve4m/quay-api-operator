<!---
DO NOT EDIT THIS FILE, BECAUSE IT IS AUTOMATICALLY GENERATED FROM A TEMPLATE.
Instead, edit the scripts/templates/docs/api.md.jinja template, and then run
the scripts/crd2markdown script.
--->

# Message - Manage Quay Container Registry global messages

The Message custom resource relies on a Secret resource to provide the connection parameters to the Quay instance.
This Secret resource must include the following data:

* `host`: URL for accessing the Quay API, such as ``https://quay.example.com:8443`` for example.
* `validateCerts`: Whether to allow insecure connections to the API.
  By default, insecure connections are refused.
* `token`: OAuth access token for authenticating against the API.
  To create such a token see the [Creating an OAuth Access Token](https://access.redhat.com/documentation/en-us/red_hat_quay/3/html-single/red_hat_quay_api_guide/index#creating-oauth-access-token) documentation.
  You can also use the [ApiToken](ApiToken.md) custom resource to create this token.
* `username`: The username to use for authenticating against the API.
  If `token` is set, then `username` is ignored.
* `password`: The password to use for authenticating against the API.
  If `token` is set, then `password` is ignored.

You can create the secret by using the `kubectl create secret` command:

```sh
kubectl create secret generic quay-credentials --from-literal host=https://quay.example.com:8443 --from-literal validateCerts=false --from-literal token=vFYyU2D0fHYXvcA3Y5TYfMrIMyVIH9YmxoVLsmku
```

Or you can create the secret from a resource file:

```yaml
---
apiVersion: v1
kind: Secret
metadata:
  name: quay-credentials
stringData:
  host: https://quay.example.com:8443
  validateCerts: "false"
  token: vFYyU2D0fHYXvcA3Y5TYfMrIMyVIH9YmxoVLsmku
```

You refer to this secret in your Message custom resource by using the `connSecretRef` property.
See the [usage example](#usage-example).

!!! warning
    Do not delete the Secret resource if it still referenced by a Quay custom resource.
    If you delete the Secret resource, then the Operator cannot connect to the Quay API anymore, and cannot synchronize the Quay custom resource with its corresponding object in Quay.
    In addition, deleting the Quay custom resource does not complete because the Operator cannot delete the corresponding object in Quay.

    If you face this issue, then edit the custom resource (`kubectl edit`), and set the [.spec.preserveInQuayOnDeletion](#preserveinquayondeletion) property to `true`.
    Alternatively, you can remove the `.metadata.finalizers` section.
    In both case, you must manually delete the corresponding object in Quay.


## Usage Example

```yaml
---
apiVersion: quay.herve4m.github.io/v1alpha1
kind: Message
metadata:
  name: message-sample
spec:
  # Connection parameters in a Secret resource
  connSecretRef:
    name: quay-credentials
    # By default, the operator looks for the secret in the same namespace as
    # the message resource, but you can specify a different namespace.
    # namespace: mynamespace

  # Whether to preserve the corresponding Quay object when you
  # delete the resource.
  preserveInQuayOnDeletion: false

  content: |
    # Information message

    Lorem **ipsum** dolor sit amet, `consectetur` adipiscing elit, sed do
    eiusmod tempor incididunt ut labore et dolore magna aliqua:

    * Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi
      ut aliquip ex ea commodo consequat.
    *  Duis aute irure dolor in reprehenderit in voluptate velit esse cillum
       dolore eu fugiat nulla pariatur
  format: markdown
  severity: warning

```


## Properties


### connSecretRef

Reference to the secret resource that stores the connection parameters to the Quay Container Registry API.
The secret must include the `host`, `token` (or `username` and `password`), and optionally the `validateCerts` keys.


__Type__: object (see the following properties)

__Required__: True

__Default value__: None

### connSecretRef.name

Name of the secret resource.

__Type__: string

__Required__: True

__Default value__: None

### connSecretRef.namespace

Namespace of the secret resource. By default, the secret resource is retrieved from the same namespace as the current Message resource.


__Type__: string

__Required__: False

__Default value__: None

### content

Text of the message to display on each web UI page.

__Type__: string

__Required__: False

__Default value__: None

### format

Format of the text in `content`. If you do not set this parameter, then the resource uses the `plain` format.

__Type__: string

__Required__: False

__Default value__: None

### preserveInQuayOnDeletion

Whether to preserve the corresponding Quay object when you delete the Message resource. When set to `false` (the default), the object is deleted from Quay.


__Type__: boolean

__Required__: False

__Default value__: False

### regexp

The regular expression to look for in the existing messages. This does not have to match an entire line. For `state=present`, if several messages match, then the resource updates one and deletes the others. For `state=absent`, the resource deletes all the messages that match. Uses Python regular expressions. See <https://docs.python.org/3/library/re.html>. Mutually exclusive with `searchString`.

__Type__: string

__Required__: False

__Default value__: None

### searchSeverity

Search messages by their severity level. If you also set `searchString`, `regexp`, or `content`, messages must match all those criteria.

__Type__: string

__Required__: False

__Default value__: None

### searchString

The literal string to look for in the existing messages. This does not have to match an entire line. For `state=present`, if several messages match, then the resource updates one and deletes the others. For `state=absent`, the resource deletes all the messages that match. Mutually exclusive with `regexp`.

__Type__: string

__Required__: False

__Default value__: None

### severity

Severity of the message. If you do not set this parameter, then the resource creates the message with the `info` severity.

__Type__: string

__Required__: False

__Default value__: None


## Listing the Message Resources

You can retrieve the list of the Message custom resources in a namespace by using the `kubectl get` command:

```sh
kubectl get messages.quay.herve4m.github.io -n <namespace>
```
