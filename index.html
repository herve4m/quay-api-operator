<!DOCTYPE html>
<html lang="en" data-bs-theme="light">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="description" content="None">
        
        
        <link rel="shortcut icon" href="img/favicon.ico">
        <title>API Operator for Quay</title>
        <link href="css/bootstrap.min.css" rel="stylesheet">
        <link href="css/fontawesome.min.css" rel="stylesheet">
        <link href="css/brands.min.css" rel="stylesheet">
        <link href="css/solid.min.css" rel="stylesheet">
        <link href="css/v4-font-face.min.css" rel="stylesheet">
        <link href="css/base.css" rel="stylesheet">
        <link id="hljs-light" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" >
        <link id="hljs-dark" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github-dark.min.css" disabled>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script>hljs.highlightAll();</script> 
    </head>

    <body class="homepage">
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href=".">API Operator for Quay</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-bs-toggle="collapse" data-bs-target="#navbar-collapse" aria-controls="navbar-collapse" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="nav-item">
                                <a href="." class="nav-link active" aria-current="page">User Guide</a>
                            </li>
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown"  aria-expanded="false">Custom Resources</a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="crds/" class="dropdown-item">Operator Custom Resources</a>
</li>
                                    
<li>
    <a href="crds/ApiToken/" class="dropdown-item">ApiToken</a>
</li>
                                    
<li>
    <a href="crds/Application/" class="dropdown-item">Application</a>
</li>
                                    
<li>
    <a href="crds/DefaultPerm/" class="dropdown-item">DefaultPerm</a>
</li>
                                    
<li>
    <a href="crds/DockerToken/" class="dropdown-item">DockerToken</a>
</li>
                                    
<li>
    <a href="crds/FirstUser/" class="dropdown-item">FirstUser</a>
</li>
                                    
<li>
    <a href="crds/ManifestLabel/" class="dropdown-item">ManifestLabel</a>
</li>
                                    
<li>
    <a href="crds/Message/" class="dropdown-item">Message</a>
</li>
                                    
<li>
    <a href="crds/Notification/" class="dropdown-item">Notification</a>
</li>
                                    
<li>
    <a href="crds/OrganizationPrune/" class="dropdown-item">OrganizationPrune</a>
</li>
                                    
<li>
    <a href="crds/Organization/" class="dropdown-item">Organization</a>
</li>
                                    
<li>
    <a href="crds/ProxyCache/" class="dropdown-item">ProxyCache</a>
</li>
                                    
<li>
    <a href="crds/Quota/" class="dropdown-item">Quota</a>
</li>
                                    
<li>
    <a href="crds/Repository/" class="dropdown-item">Repository</a>
</li>
                                    
<li>
    <a href="crds/RepositoryMirror/" class="dropdown-item">RepositoryMirror</a>
</li>
                                    
<li>
    <a href="crds/RepositoryPrune/" class="dropdown-item">RepositoryPrune</a>
</li>
                                    
<li>
    <a href="crds/Robot/" class="dropdown-item">Robot</a>
</li>
                                    
<li>
    <a href="crds/Tag/" class="dropdown-item">Tag</a>
</li>
                                    
<li>
    <a href="crds/TeamLdap/" class="dropdown-item">TeamLdap</a>
</li>
                                    
<li>
    <a href="crds/TeamOidc/" class="dropdown-item">TeamOidc</a>
</li>
                                    
<li>
    <a href="crds/Team/" class="dropdown-item">Team</a>
</li>
                                    
<li>
    <a href="crds/User/" class="dropdown-item">User</a>
</li>
                                </ul>
                            </li>
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown"  aria-expanded="false">Developer Guide</a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="developer-guide/" class="dropdown-item">Developer Guide</a>
</li>
                                    
<li>
    <a href="developer-guide/tools/" class="dropdown-item">Tools</a>
</li>
                                    
<li>
    <a href="developer-guide/building/" class="dropdown-item">Building</a>
</li>
                                    
<li>
    <a href="developer-guide/deploying/" class="dropdown-item">Deploying</a>
</li>
                                    
<li>
    <a href="developer-guide/testing/" class="dropdown-item">Testing</a>
</li>
                                    
<li>
    <a href="developer-guide/releasing/" class="dropdown-item">Releasing to OperatorHub.io</a>
</li>
                                </ul>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ms-md-auto">
                            <li class="nav-item">
                                <a rel="prev" class="nav-link disabled">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" href="crds/" class="nav-link">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a href="https://github.com/herve4m/quay-api-operator/edit/main/docs/README.md" class="nav-link"><i class="fa-brands fa-github"></i> Edit on GitHub</a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-bs-toggle="collapse" data-bs-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-body-tertiary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-bs-level="1"><a href="#user-guide" class="nav-link">User Guide</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-bs-level="2"><a href="#description" class="nav-link">Description</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#usage" class="nav-link">Usage</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-bs-level="3"><a href="#connection-parameters" class="nav-link">Connection Parameters</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="3"><a href="#deleting-resources" class="nav-link">Deleting Resources</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="user-guide">User Guide</h1>
<p>The API Operator for Quay manages Quay Container Registry deployments by using Kubernetes resources.</p>
<h2 id="description">Description</h2>
<p>The Operator provides Kubernetes custom resources to create, configure, and delete Quay objects.
For example, the Operator can manage Quay organizations, repositories, teams, and user and robot accounts.
It can also configure organization quotas, repository mirroring, and proxy caches.</p>
<p>The operator does not install Quay, which you can install in Kubernetes by using the <a href="https://operatorhub.io/operator/project-quay">Quay Operator</a>, or outside Kubernetes as a standalone deployment.</p>
<p>The <a href="crds/">Custom Resources</a> section lists the Custom Resource Definitions (CDRs) that the Operator provides, and gives usage examples.</p>
<p>For more details on Quay installation and usage, refer to the <a href="https://docs.projectquay.io/welcome.html">Project Quay Documentation</a>.</p>
<h2 id="usage">Usage</h2>
<p>After you install the Operator in your Kubernetes or Openshift cluster, you can use the CRDs that the Operator installs to manage your Quay instances.</p>
<h3 id="connection-parameters">Connection Parameters</h3>
<p>All the Operator's custom resources rely on a Secret resource to provide the connection parameters to the Quay instance to manage.
This Secret resource must include the following data:</p>
<ul>
<li><code>host</code>: URL for accessing the Quay API, such as <code>https://quay.example.com:8443</code>.</li>
<li><code>validateCerts</code>: Whether to allow insecure connections to the API.
  By default, insecure connections are refused.</li>
<li><code>token</code>: OAuth access token for authenticating against the API.
  To create such a token see the <a href="https://access.redhat.com/documentation/en-us/red_hat_quay/3/html-single/red_hat_quay_api_guide/index#creating-oauth-access-token">Creating an OAuth Access Token</a> documentation.
  You can also use the <a href="crds/ApiToken/">ApiToken</a> custom resource to create this token.</li>
<li><code>username</code>: The username to use for authenticating against the API.
  If <code>token</code> is set, then <code>username</code> is ignored.</li>
<li><code>password</code>: The password to use for authenticating against the API.
  If <code>token</code> is set, then <code>password</code> is ignored.</li>
</ul>
<p>You can create the secret by using the <code>kubectl create secret</code> command:</p>
<pre><code class="language-sh">kubectl create secret generic quay-credentials --from-literal host=https://quay.example.com:8443 --from-literal validateCerts=false --from-literal token=vFYyU2D0fHYXvcA3Y5TYfMrIMyVIH9YmxoVLsmku
</code></pre>
<p>Or you can create the secret from a resource file:</p>
<pre><code class="language-yaml">---
apiVersion: v1
kind: Secret
metadata:
  name: quay-credentials
stringData:
  host: https://quay.example.com:8443
  validateCerts: &quot;false&quot;
  token: vFYyU2D0fHYXvcA3Y5TYfMrIMyVIH9YmxoVLsmku
</code></pre>
<p>You refer to this secret in your Quay custom resources by using the <code>connSecretRef</code> property:</p>
<pre><code class="language-yaml">---
apiVersion: quay.herve4m.github.io/v1alpha1
kind: Organization
metadata:
  name: organization-sample
spec:
  # Connection parameters in a Secret resource
  connSecretRef:
    name: quay-credentials
    # By default, the operator looks for the secret in the same namespace as
    # the organization resource, but you can specify a different namespace.
    # namespace: mynamespace

  name: production
  email: prodlist@example.com
  timeMachineExpiration: 7d
  autoPruneMethod: tags
  autoPruneValue: &quot;20&quot;
  preserveInQuayOnDeletion: false
</code></pre>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Do not delete the Secret resource if a Quay custom resource still references it.
If you delete the Secret resource, then the Operator cannot connect to the Quay API anymore, and cannot synchronize the Quay custom resource with its corresponding object in Quay.
In addition, deleting the Quay custom resource does not complete because the Operator cannot delete the corresponding object in Quay.</p>
<p>If you face this issue, then edit the custom resource (<code>kubectl edit</code>), and set the <a href="#deleting-resources">.spec.preserveInQuayOnDeletion</a> property to <code>true</code>.
Alternatively, you can remove the <code>.metadata.finalizers</code> section.
In both case, you must manually delete the corresponding object in Quay.</p>
</div>
<h3 id="deleting-resources">Deleting Resources</h3>
<p>By default, when you delete a resource from your Kubernetes cluster, the Operator automatically removes the corresponding object in Quay.
This behavior is controlled by the <code>preserveInQuayOnDeletion</code> property of the custom resources.
By setting the property to <code>true</code>, you instruct the Operator to keep the object in Quay.</p>
<p>The <code>Robot</code> custom resource in the following example manages the <code>production+robotprod</code> Quay robot account.
The <code>preserveInQuayOnDeletion</code> property is set to <code>true</code>, therefore, if you delete the Kubernetes resource, then the Operator does not delete the robot account in Quay.</p>
<pre><code class="language-yaml">---
apiVersion: quay.herve4m.github.io/v1alpha1
kind: Robot
metadata:
  name: robot-sample
spec:
  connSecretRef:
    name: quay-credentials-secret
    namespace: mynamespace

  # Preserve the robot account in Quay when you delete the resource.
  preserveInQuayOnDeletion: true

  name: production+robotprod
  description: Robot account for production
  retSecretRef:
    name: robot-account-credentials
    namespace: mynamespace
</code></pre></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script src="js/bootstrap.bundle.min.js"></script>
        <script>
            var base_url = ".",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="js/base.js"></script>

        <div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>

<!--
MkDocs version : 1.6.1
Build Date UTC : 2024-11-26 13:04:47.316580+00:00
-->
