<!DOCTYPE html>
<html lang="en" data-bs-theme="light">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../img/favicon.ico">
        <title>Repository - API Operator for Quay</title>
        <link href="../../css/bootstrap.min.css" rel="stylesheet">
        <link href="../../css/fontawesome.min.css" rel="stylesheet">
        <link href="../../css/brands.min.css" rel="stylesheet">
        <link href="../../css/solid.min.css" rel="stylesheet">
        <link href="../../css/v4-font-face.min.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        <link id="hljs-light" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" >
        <link id="hljs-dark" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github-dark.min.css" disabled>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script>hljs.highlightAll();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="../..">API Operator for Quay</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-bs-toggle="collapse" data-bs-target="#navbar-collapse" aria-controls="navbar-collapse" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="nav-item">
                                <a href="../.." class="nav-link">User Guide</a>
                            </li>
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle active" aria-current="page" role="button" data-bs-toggle="dropdown"  aria-expanded="false">Custom Resources</a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../" class="dropdown-item">Operator Custom Resources</a>
</li>
                                    
<li>
    <a href="../ApiToken/" class="dropdown-item">ApiToken</a>
</li>
                                    
<li>
    <a href="../Application/" class="dropdown-item">Application</a>
</li>
                                    
<li>
    <a href="../DefaultPerm/" class="dropdown-item">DefaultPerm</a>
</li>
                                    
<li>
    <a href="../DockerToken/" class="dropdown-item">DockerToken</a>
</li>
                                    
<li>
    <a href="../FirstUser/" class="dropdown-item">FirstUser</a>
</li>
                                    
<li>
    <a href="../ManifestLabel/" class="dropdown-item">ManifestLabel</a>
</li>
                                    
<li>
    <a href="../Message/" class="dropdown-item">Message</a>
</li>
                                    
<li>
    <a href="../Notification/" class="dropdown-item">Notification</a>
</li>
                                    
<li>
    <a href="../OrganizationPrune/" class="dropdown-item">OrganizationPrune</a>
</li>
                                    
<li>
    <a href="../Organization/" class="dropdown-item">Organization</a>
</li>
                                    
<li>
    <a href="../ProxyCache/" class="dropdown-item">ProxyCache</a>
</li>
                                    
<li>
    <a href="../Quota/" class="dropdown-item">Quota</a>
</li>
                                    
<li>
    <a href="./" class="dropdown-item active" aria-current="page">Repository</a>
</li>
                                    
<li>
    <a href="../RepositoryMirror/" class="dropdown-item">RepositoryMirror</a>
</li>
                                    
<li>
    <a href="../RepositoryPrune/" class="dropdown-item">RepositoryPrune</a>
</li>
                                    
<li>
    <a href="../Robot/" class="dropdown-item">Robot</a>
</li>
                                    
<li>
    <a href="../Tag/" class="dropdown-item">Tag</a>
</li>
                                    
<li>
    <a href="../TeamLdap/" class="dropdown-item">TeamLdap</a>
</li>
                                    
<li>
    <a href="../TeamOidc/" class="dropdown-item">TeamOidc</a>
</li>
                                    
<li>
    <a href="../Team/" class="dropdown-item">Team</a>
</li>
                                    
<li>
    <a href="../User/" class="dropdown-item">User</a>
</li>
                                </ul>
                            </li>
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown"  aria-expanded="false">Developer Guide</a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../developer-guide/" class="dropdown-item">Developer Guide</a>
</li>
                                    
<li>
    <a href="../../developer-guide/tools/" class="dropdown-item">Tools</a>
</li>
                                    
<li>
    <a href="../../developer-guide/building/" class="dropdown-item">Building</a>
</li>
                                    
<li>
    <a href="../../developer-guide/deploying/" class="dropdown-item">Deploying</a>
</li>
                                    
<li>
    <a href="../../developer-guide/testing/" class="dropdown-item">Testing</a>
</li>
                                    
<li>
    <a href="../../developer-guide/releasing/" class="dropdown-item">Releasing to OperatorHub.io</a>
</li>
                                </ul>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ms-md-auto">
                            <li class="nav-item">
                                <a rel="prev" href="../Quota/" class="nav-link">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" href="../RepositoryMirror/" class="nav-link">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a href="https://github.com/herve4m/quay-api-operator/edit/main/docs/crds/Repository.md" class="nav-link"><i class="fa-brands fa-github"></i> Edit on GitHub</a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-bs-toggle="collapse" data-bs-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-body-tertiary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-bs-level="1"><a href="#repository-manage-quay-container-registry-repositories" class="nav-link">Repository - Manage Quay Container Registry repositories</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-bs-level="2"><a href="#usage-example" class="nav-link">Usage Example</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#properties" class="nav-link">Properties</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-bs-level="3"><a href="#append" class="nav-link">append</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="3"><a href="#autoprunemethod" class="nav-link">autoPruneMethod</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="3"><a href="#autoprunevalue" class="nav-link">autoPruneValue</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="3"><a href="#connsecretref" class="nav-link">connSecretRef</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="3"><a href="#connsecretrefname" class="nav-link">connSecretRef.name</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="3"><a href="#connsecretrefnamespace" class="nav-link">connSecretRef.namespace</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="3"><a href="#description" class="nav-link">description</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="3"><a href="#name" class="nav-link">name</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="3"><a href="#perms" class="nav-link">perms</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="3"><a href="#preserveinquayondeletion" class="nav-link">preserveInQuayOnDeletion</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="3"><a href="#repostate" class="nav-link">repoState</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="3"><a href="#star" class="nav-link">star</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="3"><a href="#visibility" class="nav-link">visibility</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#listing-the-repository-resources" class="nav-link">Listing the Repository Resources</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<!---
DO NOT EDIT THIS FILE, BECAUSE IT IS AUTOMATICALLY GENERATED FROM A TEMPLATE.
Instead, edit the scripts/templates/docs/api.md.jinja template, and then run
the scripts/crd2markdown script.
--->

<h1 id="repository-manage-quay-container-registry-repositories">Repository - Manage Quay Container Registry repositories</h1>
<p>The Repository custom resource relies on a Secret resource to provide the connection parameters to the Quay instance.
This Secret resource must include the following data:</p>
<ul>
<li><code>host</code>: URL for accessing the Quay API, such as <code>https://quay.example.com:8443</code> for example.</li>
<li><code>validateCerts</code>: Whether to allow insecure connections to the API.
  By default, insecure connections are refused.</li>
<li><code>token</code>: OAuth access token for authenticating against the API.
  To create such a token see the <a href="https://access.redhat.com/documentation/en-us/red_hat_quay/3/html-single/red_hat_quay_api_guide/index#creating-oauth-access-token">Creating an OAuth Access Token</a> documentation.
  You can also use the <a href="../ApiToken/">ApiToken</a> custom resource to create this token.</li>
<li><code>username</code>: The username to use for authenticating against the API.
  If <code>token</code> is set, then <code>username</code> is ignored.</li>
<li><code>password</code>: The password to use for authenticating against the API.
  If <code>token</code> is set, then <code>password</code> is ignored.</li>
</ul>
<p>You can create the secret by using the <code>kubectl create secret</code> command:</p>
<pre><code class="language-sh">kubectl create secret generic quay-credentials --from-literal host=https://quay.example.com:8443 --from-literal validateCerts=false --from-literal token=vFYyU2D0fHYXvcA3Y5TYfMrIMyVIH9YmxoVLsmku
</code></pre>
<p>Or you can create the secret from a resource file:</p>
<pre><code class="language-yaml">---
apiVersion: v1
kind: Secret
metadata:
  name: quay-credentials
stringData:
  host: https://quay.example.com:8443
  validateCerts: &quot;false&quot;
  token: vFYyU2D0fHYXvcA3Y5TYfMrIMyVIH9YmxoVLsmku
</code></pre>
<p>You refer to this secret in your Repository custom resource by using the <code>connSecretRef</code> property.
See the <a href="#usage-example">usage example</a>.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Do not delete the Secret resource if a Quay custom resource still references it.
If you delete the Secret resource, then the Operator cannot connect to the Quay API anymore, and cannot synchronize the Quay custom resource with its corresponding object in Quay.
In addition, deleting the Quay custom resource does not complete because the Operator cannot delete the corresponding object in Quay.</p>
<p>If you face this issue, then edit the custom resource (<code>kubectl edit</code>), and set the <a href="#preserveinquayondeletion">.spec.preserveInQuayOnDeletion</a> property to <code>true</code>.
Alternatively, you can remove the <code>.metadata.finalizers</code> section.
In both case, you must manually delete the corresponding object in Quay.</p>
</div>
<h2 id="usage-example">Usage Example</h2>
<pre><code class="language-yaml">---
apiVersion: quay.herve4m.github.io/v1alpha1
kind: Repository
metadata:
  name: repository-sample-1
spec:
  # Connection parameters in a Secret resource
  connSecretRef:
    name: quay-credentials
    # By default, the operator looks for the secret in the same namespace as
    # the repository resource, but you can specify a different namespace.
    # namespace: mynamespace

  # Whether to preserve the corresponding Quay object when you
  # delete the Repository resource.
  preserveInQuayOnDeletion: false

  name: production/smallimage
  visibility: public
  description: |
    # My first repository

    * smallimage is a small GNU/linux container image.
    * Use podman to start a container using that image.
  perms:
    - name: operators
      type: team
      role: read
    - name: dwilde
      type: user
      role: read
    - name: production+robotprod1
      type: user
      role: admin
  append: true
  star: true
  repoState: NORMAL
---
apiVersion: quay.herve4m.github.io/v1alpha1
kind: Repository
metadata:
  name: repository-sample-2
spec:
  # Connection parameters in a Secret resource
  connSecretRef:
    name: quay-credentials
    # By default, the operator looks for the secret in the same namespace as the
    # repository resource, but you can specify a different namespace.
    # repository: mynamespace

  # Whether to preserve the corresponding Quay object when you
  # delete the resource.
  preserveInQuayOnDeletion: false

  name: production/ubi9
  repoState: MIRROR

</code></pre>
<h2 id="properties">Properties</h2>
<h3 id="append">append</h3>
<p>If <code>true</code>, then add the permission defined in <code>perms</code> to the repository. If <code>false</code>, then the resource sets the permissions specified in <code>perms</code>, removing all others permissions from the repository.</p>
<p><strong>Type</strong>: boolean</p>
<p><strong>Required</strong>: False</p>
<p><strong>Default value</strong>: True</p>
<h3 id="autoprunemethod">autoPruneMethod</h3>
<p>The <code>autoPruneMethod</code> parameter is deprecated and will be removed in future versions of the collection. Use the OrganizationPrune and the RepositoryPrune resources instead. Method to use for the auto-pruning tags policy. If <code>none</code>, then the resource ensures that no policy is in place. The tags are not pruned. If several policies are available, then the resource removes them all. If <code>tags</code>, then the policy keeps only the number of tags that you specify in <code>autoPruneValue</code>. If <code>date</code>, then the policy deletes the tags older than the time period that you specify in <code>autoPruneValue</code>. <code>autoPruneValue</code> is required when <code>autoPruneMethod</code> is <code>tags</code> or <code>date</code>.</p>
<p><strong>Type</strong>: string</p>
<p><strong>Required</strong>: False</p>
<p><strong>Default value</strong>: None</p>
<h3 id="autoprunevalue">autoPruneValue</h3>
<p>The <code>autoPruneValue</code> parameter is deprecated and will be removed in future versions of the collection. Use the OrganizationPrune and the RepositoryPrune resources instead. Number of tags to keep when <code>autoPruneMethod</code> is <code>tags</code>. The value must be 1 or more. Period of time when <code>autoPruneMethod</code> is <code>date</code>. The value must be 1 or more, and must be followed by a suffix; s (for second), m (for minute), h (for hour), d (for day), or w (for week). <code>autoPruneMethod</code> is required when <code>autoPruneValue</code> is set.</p>
<p><strong>Type</strong>: string</p>
<p><strong>Required</strong>: False</p>
<p><strong>Default value</strong>: None</p>
<h3 id="connsecretref">connSecretRef</h3>
<p>Reference to the secret resource that stores the connection parameters to the Quay Container Registry API.
The secret must include the <code>host</code>, <code>token</code> (or <code>username</code> and <code>password</code>), and optionally the <code>validateCerts</code> keys.</p>
<p><strong>Type</strong>: object (see the following properties)</p>
<p><strong>Required</strong>: True</p>
<p><strong>Default value</strong>: None</p>
<h3 id="connsecretrefname">connSecretRef.name</h3>
<p>Name of the secret resource.</p>
<p><strong>Type</strong>: string</p>
<p><strong>Required</strong>: True</p>
<p><strong>Default value</strong>: None</p>
<h3 id="connsecretrefnamespace">connSecretRef.namespace</h3>
<p>Namespace of the secret resource. By default, the secret resource is retrieved from the same namespace as the current Repository resource.</p>
<p><strong>Type</strong>: string</p>
<p><strong>Required</strong>: False</p>
<p><strong>Default value</strong>: None</p>
<h3 id="description">description</h3>
<p>Text in Markdown format that describes the repository.</p>
<p><strong>Type</strong>: string</p>
<p><strong>Required</strong>: False</p>
<p><strong>Default value</strong>: None</p>
<h3 id="name">name</h3>
<p>Name of the repository to create, remove, or modify. The format for the name is <code>namespace</code>/<code>shortname</code>. The namespace can be an organization or your personal namespace. The name must be in lowercase and must not contain white spaces. If you omit the namespace part in the name, then the resource uses your personal namespace. You can manage repositories in your personal namespace, but not in the personal namespace of other users. The token you use in <code>quayToken</code> determines the user account you are using.</p>
<p><strong>Type</strong>: string</p>
<p><strong>Required</strong>: True</p>
<p><strong>Default value</strong>: None</p>
<h3 id="perms">perms</h3>
<p>User, robot, and team permissions to associate with the repository.</p>
<p><strong>Type</strong>: array</p>
<p><strong>Required</strong>: False</p>
<p><strong>Default value</strong>: None</p>
<h3 id="preserveinquayondeletion">preserveInQuayOnDeletion</h3>
<p>Whether to preserve the corresponding Quay object when you delete the Repository resource. When set to <code>false</code> (the default), the object is deleted from Quay.</p>
<p><strong>Type</strong>: boolean</p>
<p><strong>Required</strong>: False</p>
<p><strong>Default value</strong>: False</p>
<h3 id="repostate">repoState</h3>
<p>If <code>NORMAL</code>, then the repository is in the default state (read/write). If <code>READ_ONLY</code>, then the repository is read-only. If <code>MIRROR</code>, then the repository is a mirror and you can configure it by using the RepositoryMirror resource. You must enable the mirroring capability of your Quay installation to use this <code>repoState</code> parameter.</p>
<p><strong>Type</strong>: string</p>
<p><strong>Required</strong>: False</p>
<p><strong>Default value</strong>: None</p>
<h3 id="star">star</h3>
<p>If <code>true</code>, then add a star to the repository. If <code>false</code>, then remove the star. To star or unstar a repository you must provide the <code>quayToken</code> parameter to authenticate. If you are not authenticated, then the resource ignores the <code>star</code> parameter.</p>
<p><strong>Type</strong>: boolean</p>
<p><strong>Required</strong>: False</p>
<p><strong>Default value</strong>: None</p>
<h3 id="visibility">visibility</h3>
<p>If <code>public</code>, then anyone can pull images from the repository. If <code>private</code>, then nobody can access the repository and you need to explicitly grant access to users, robots, and teams. If you do not set the parameter when you create a repository, then it defaults to <code>private</code>.</p>
<p><strong>Type</strong>: string</p>
<p><strong>Required</strong>: False</p>
<p><strong>Default value</strong>: None</p>
<h2 id="listing-the-repository-resources">Listing the Repository Resources</h2>
<p>You can retrieve the list of the Repository custom resources in a namespace by using the <code>kubectl get</code> command:</p>
<pre><code class="language-sh">kubectl get repositories.quay.herve4m.github.io -n &lt;namespace&gt;
</code></pre>
<p>You can also use the short version for the resource type:</p>
<pre><code class="language-sh">kubectl get repo -n &lt;namespace&gt;
</code></pre></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script src="../../js/bootstrap.bundle.min.js"></script>
        <script>
            var base_url = "../..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../../js/base.js"></script>

        <div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
